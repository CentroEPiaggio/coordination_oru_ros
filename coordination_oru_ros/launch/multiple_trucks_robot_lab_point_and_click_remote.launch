<?xml version="1.0"?>
<launch>

  <include file="$(find gazebo_worlds_oru)/launch/robot_lab_map_server.launch"/>
  
  <rosparam command="load" file="$(find orunav_params)/config/global.cfg"/>
  <rosparam command="load" file="$(find orunav_params)/config/citi1.cfg" />
  <rosparam command="load" file="$(find orunav_params)/config/citi2.cfg" />
  
  <arg name="robot_ids" default="[1,2]" />
  <arg name="active_robot_ids" default="[1,2]" />
  <arg name="max_unsafety_probability" default="0.0001" /> 
  <arg name="max_packet_loss_probability" default="0.0" /> 
  <arg name="min_tx_delay_millis" default="10" />
  <arg name="max_tx_delay_millis" default="400" />
  <arg name="heartbeat_report_period_sec" default="1.0" />
 
  <node name="coordinator" pkg="coordination_oru_ros" type="coordinator" args="se.oru.coordination.coordinator.ros_coordinator.generic.MainNode" output="screen">
    <rosparam param="robot_ids" subst_value="true">$(arg robot_ids)</rosparam>
    <rosparam param="active_robot_ids" subst_value="true">$(arg active_robot_ids)</rosparam>
    <param name="footprint_rear_left_x" value="-0.2" />
    <param name="footprint_rear_left_y" value="0.3" />
    <param name="footprint_rear_right_x" value="-0.2" />
    <param name="footprint_rear_right_y" value="-0.3" />
    <param name="footprint_front_left_x" value="1.9" />
    <param name="footprint_front_left_y" value="0.3" />
    <param name="footprint_front_right_x" value="1.9" />
    <param name="footprint_front_right_y" value="-0.3" />
    <param name="control_period" value="1000" />
    <param name="report_period" value="$(eval int(1000 * arg('heartbeat_report_period_sec')))" />
    <param name="temporal_resolution" value="1000.0" />
    <param name="forward_model_max_accel" value="0.1" />
    <param name="forward_model_max_vel" value="0.3" />
    <param name="max_unsafety_probability" value="$(arg max_unsafety_probability)" />
    <param name="max_packet_loss_probability" value="$(arg max_packet_loss_probability)" />
    <!--param name="max_tx_delay_millis" value="$(eval 2*arg(max_tx_delay_millis))" /-->
    <param name="max_tx_delay_millis" value="500" /> 
    <param name="use_execute_task_service" value="false" /> 
    <param name="report_topic" value="report_delayed" />
    <param name="locations_file" value="$(find coordination_oru_ros)/missions/robot_lab_locations_udp.txt" />
    <param name="goal_sequence_file" value="$(find coordination_oru_ros)/missions/robot_lab_goal_sequence_udp.txt" />
  </node>

  <include file="$(find orunav_channel)/launch/channel_model.launch" >
      <arg name="robot_ids" value="$(arg active_robot_ids)" />
      <arg name="max_unsafety_probability" value="$(arg max_unsafety_probability)" />
      <arg name="max_packet_loss_probability" value="$(arg max_packet_loss_probability)" />
      <arg name="min_tx_delay_millis" value="$(arg min_tx_delay_millis)" />
      <arg name="max_tx_delay_millis" value="$(arg max_tx_delay_millis)"/>
      <arg name="tf_prefix" value="/robot" />
      <arg name="report_topic" value="report" />
      <arg name="execute_task_topic" value="unreliable_execute_task" />
      <arg name="execute_task_service" value="execute_task" />
  </include>

  <node name="rviz" pkg="rviz" type="rviz" args="-d $(find cititruck_description)/launch/cititrucks2.rviz"/>

</launch>
